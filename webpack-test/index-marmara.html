<!DOCTYPE html>
<html>
  <head>
    <style>
    .myDiv {
      border: 1px;
    }
    </style>
    </head>
<body>
  <!-- <script type="module">
    import { Connect } from "./ccfaucetpocbr.js" 
  
    function myConnect() {
      return Connect();
    }
  </script> 
  <script" src="./index.js"></script>-->

   <h2>CC Marmara Demo</h2>
   <h4>Demo keys:</h4>
   <table>
    <tr>
      <th>Wif</th><th>Pubkey</th>
    </tr>
    <tr>
      <td>UpUdyyTPFsXv8s8Wn83Wuc4iRsh5GDUcz8jVFiE3SxzFSfgNEyed</td><td>035d3b0f2e98cf0fba19f80880ec7c08d770c6cf04aa5639bc57130d5ac54874db</td>
    </tr>
    <tr>
      <td>UuKUSQHnRGk4CDbRnbLRrJHq5Dwx58qR9Q9K2VpJjn3APXLurNcu</td><td>034777b18effce6f7a849b72de8e6810bf7a7e050274b3782e1b5a13d0263a44dc</td>
    </tr>
    <tr>
      <td>UuiZgPmUeo3Qe6BPH8GiSxqzFLN7MgJmw8SRijF9AFJoEsDFpMys</td><td>0306ecb5e98f517cb2e58922404049ec3d2ca1b72c66a784a7a8dfdd03eb33312b</td>
    </tr>
   </table>

  <!--<button type="button" onclick="myConnect().then((result)=>{ document.write('Connected!').catch((err)=>{ document.write('could not connect: ' + err.message); }); })">Connect-to-Peer</button>-->
  <!--<button type="button" onclick="myFunction()">Connect-to-Peer</button>-->
  <div class="myDiv">
  <h4>Connect to chain:</h4>
  <button type="button" id="btnConnect">Connect Peer</button><label id="idConnectRes"></label>
  </div>

  <div class="myDiv">
  <h4>MarmaraLock:</h4>
  <form>
    <label for="idMarmaraLockWif">Wif:</label>
    <input type="text" id="idMarmaraLockWif" name="Wif" value="" size=60><br>
    <label for="idMarmaraLockAmount">Amount:</label>
    <input type="text" id="idMarmaraLockAmount" name="amount" value="0.00001">
    <input type="button" id="btnMarmaraLock" value="MarmaraLock">
    <label id="idMarmaraLockNotify"></label>
  </form> 
  </div>

  <div class="myDiv">
    <h4>MarmaraReceive:</h4>
    <form>
      <label for="idMarmaraReceiveWif">Wif:</label>
      <input type="text" id="idMarmaraReceiveWif" name="Wif" value="" size=60><br>
      <label for="idMarmaraSenderPubkey">Sender Pubkey:</label>
      <input type="text" id="idMarmaraSenderPubkey" name="Sender Pubkey" value="" size=74>
      <label for="idMarmaraLoopAmount">Amount:</label>
      <input type="text" id="idMarmaraLoopAmount" name="amount" value="0.00001">
      <label for="idMarmaraMatures">Matures:</label>
      <input type="text" id="idMarmaraMatures" name="matures" value="1000">
      <input type="button" id="btnMarmaraReceive" value="MarmaraReceive">
      <label id="idMarmaraReceiveNotify"></label>
    </form> 
  </div>

  <div class="myDiv">
    <h4>MarmaraIssue:</h4>
    <form>
      <label for="idMarmaraIssueWif">Wif:</label>
      <input type="text" id="idMarmaraIssueWif" name="Wif" value="" size=60><br>
      <label for="idMarmaraReceiveTxid">Receive Txid:</label>
      <input type="text" id="idMarmaraReceiveTxid" name="Receive Txid" value="" size=70>
      <label for="idMarmaraReceiverPubkey">Receiver Pubkey:</label>
      <input type="text" id="idMarmaraReceiverPubkey" name="Receiver Pubkey" value="" size=74>
      <input type="button" id="btnMarmaraIssue" value="MarmaraIssue">
      <label id="idMarmaraIssueNotify"></label>
    </form> 
  </div>    

  <div class="myDiv">
    <h4>MarmaraReceive for Transfer:</h4>
    <form>
      <label for="idMarmaraReceiveForTransferWif">Wif:</label>
      <input type="text" id="idMarmaraReceiveForTransferWif" name="Wif" value="" size=60><br>
      <label for="idMarmaraTransferSenderPubkey">Sender Pubkey:</label>
      <input type="text" id="idMarmaraTransferSenderPubkey" name="Sender Pubkey" value="" size=74>
      <label for="idMarmaraBatonTxid">BatonTxid:</label>
      <input type="text" id="idMarmaraBatonTxid" value="" size=70>
      <input type="button" id="btnMarmaraReceiveNext" value="MarmaraReceive for Transfer">
      <label id="idMarmaraReceiveNextNotify"></label>
    </form> 
  </div>

  <div class="myDiv">
    <h4>MarmaraTransfer:</h4>
    <form>
      <label for="idMarmaraTransferWif">Wif:</label>
      <input type="text" id="idMarmaraTransferWif" name="Wif" value="" size=60><br>
      <label for="idMarmaraReceiveForTransferTxid">Receive Txid:</label>
      <input type="text" id="idMarmaraReceiveForTransferTxid" name="Receive Txid" value="" size=70>
      <label for="idMarmaraTransferReceiverPubkey">Receiver Pubkey:</label>
      <input type="text" id="idMarmaraTransferReceiverPubkey" name="Receiver Pubkey" value="" size=74>
      <input type="button" id="btnMarmaraTransfer" value="MarmaraTransfer">
      <label id="idMarmaraTransferNotify"></label>
    </form> 
  </div> 
  
  <h4>Transaction:</h4>
  <p>
  <label>txhex:</label><br>
  <textarea id="idTxhex" rows="8" cols="100"></textarea> <button type="button" id="btnBroadcast">Broadcast</button><br>
  <label>txid: </label><label id="idTxid"></label>
  </p>

  <h4>MarmaraInfo:</h4>
  <p>
    <label for="idMarmaraInfoPubkey">Pubkey:</label>
    <input type="text" id="idMarmaraInfoPubkey" name="Pubkey" value="" size=74>
    <input type="button" id="btnMarmaraInfo" value="MarmaraInfo"><br>
    <!--<label>marmarainfo: </label> -->
    <textarea id="idMarmaraInfo" rows="20" cols="100"></textarea>
    <!--<label id="idMarmaraInfo"></label>-->
  </p>

  <h4>MarmaraReceiveList:</h4>
  <p>
    <label for="idMarmaraReceiveListPubkey">Pubkey:</label>
    <input type="text" id="idMarmaraReceiveListPubkey" name="Pubkey" value="" size=74>
    <input type="button" id="btnMarmaraReceiveList" value="MarmaraReceiveList"><br>
    <!--<label>marmarainfo: </label> -->
    <textarea id="idMarmaraReceiveListResults" rows="20" cols="100"></textarea>
  </p>

  <h4>MarmaraGetCreditLoopList:</h4>
  <p>
    <label for="idMarmaraGetCreditLoopPubkey">Pubkey:</label>
    <input type="text" id="idMarmaraGetCreditLoopPubkey" name="Pubkey" value="" size=74>
    <label for="idMarmaraGetCreditLoopBatonTxid">Baton Txid:</label>
    <input type="text" id="idMarmaraGetCreditLoopBatonTxid" value="" size=70>
    <input type="button" id="btnMarmaraGetCreditLoop" value="MarmaraGetCreditLoop"><br>
    <textarea id="idMarmaraGetCreditLoopResults" rows="20" cols="100"></textarea>
  </p>

<script src="./ccmarmarapocbr-bundle.js"></script>
<script>
  //console.log(myLibrary)
  //console.log(myLibrary.Connect())
  document.getElementById("btnConnect").onclick = myConnect; 
  document.getElementById("btnMarmaraLock").onclick = marmaraLock; 
  document.getElementById("btnMarmaraReceive").onclick = marmaraReceive; 
  document.getElementById("btnMarmaraReceiveNext").onclick = marmaraReceiveNext; 
  document.getElementById("btnMarmaraIssue").onclick = marmaraIssue; 
  document.getElementById("btnMarmaraTransfer").onclick = marmaraTransfer; 
  document.getElementById("btnBroadcast").onclick = broadcastTxhex; 
  document.getElementById("btnMarmaraInfo").onclick = marmaraInfo; 
  document.getElementById("btnMarmaraReceiveList").onclick = marmaraReceiveList; 
  document.getElementById("btnMarmaraGetCreditLoop").onclick = marmaraGetCreditLoop; 


  localStorage.debug = 'bitcoin-net:peer,bitcoin-net:peergroup'
  var connected = false;

  function myConnect() {
    document.getElementById("idConnectRes").innerHTML = '';
    myLibrary.Connect()
      .then(()=>{ 
        console.log('in browser: connected to peer'); 
        //console.log('res:', res, 'peer:', peer)
        document.getElementById("idConnectRes").innerHTML = ' connected';
        connected = true;
      }) 
      .catch((err, peer) => {
        console.log('connect error:', err, 'peer:', peer);
        document.getElementById("idConnectRes").innerHTML = ' connect error: '+err.message;
      })
  }

  function marmaraLock() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let wif = document.getElementById("idMarmaraLockWif").value;
    let amount = parseFloat(document.getElementById("idMarmaraLockAmount").value);

    document.getElementById("idTxhex").value = '';
    document.getElementById("idTxid").innerHTML = '';
    document.getElementById("idMarmaraLockNotify").innerHTML = "Scroll to 'Transaction' to see the results";

    myLibrary.marmaraLock(wif, amount)
      .then((res)=>{ 
        document.getElementById("idTxhex").value = res.txhex;
      }) 
      .catch(err=>{
        document.getElementById("idTxhex").value = 'tx creation error: '+err.message;
      })
  }

  function marmaraReceive() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let wif = document.getElementById("idMarmaraReceiveWif").value;
    let senderpk = document.getElementById("idMarmaraSenderPubkey").value;
    let amount = parseFloat(document.getElementById("idMarmaraLoopAmount").value);
    let matures = parseInt(document.getElementById("idMarmaraMatures").value);

    document.getElementById("idTxhex").value = '';
    document.getElementById("idTxid").innerHTML = '';
    document.getElementById("idMarmaraReceiveNotify").innerHTML = "Scroll to 'Transaction' to see the results";

    myLibrary.marmaraReceive(wif, senderpk, amount, matures)
      .then((res)=>{ 
        document.getElementById("idTxhex").value = res.txhex;
      }) 
      .catch(err=>{
        document.getElementById("idTxhex").value = 'tx creation error: '+err.message;
      })
  }

  function marmaraIssue() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let wif = document.getElementById("idMarmaraIssueWif").value;
    let receivetxid = document.getElementById("idMarmaraReceiveTxid").value;
    let receiverpk = document.getElementById("idMarmaraReceiverPubkey").value;

    document.getElementById("idTxhex").value = '';
    document.getElementById("idTxid").innerHTML = '';
    document.getElementById("idMarmaraIssueNotify").innerHTML = "Scroll to 'Transaction' to see the results";


    myLibrary.marmaraIssue(wif, receivetxid, receiverpk)
      .then((res)=>{ 
        document.getElementById("idTxhex").value = res.txhex;
      }) 
      .catch(err=>{
        document.getElementById("idTxhex").value = 'tx creation error: '+err.message;
      })
  }

  function marmaraReceiveNext() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let wif = document.getElementById("idMarmaraReceiveForTransferWif").value;
    let senderpk = document.getElementById("idMarmaraTransferSenderPubkey").value;
    let batontxid = document.getElementById("idMarmaraBatonTxid").value;

    document.getElementById("idTxhex").value = '';
    document.getElementById("idTxid").innerHTML = '';
    document.getElementById("idMarmaraReceiveNextNotify").innerHTML = "Scroll to 'Transaction' to see the results";

    myLibrary.marmaraReceiveNext(wif, senderpk, batontxid)
      .then((res)=>{ 
        document.getElementById("idTxhex").value = res.txhex;
      }) 
      .catch(err=>{
        document.getElementById("idTxhex").value = 'tx creation error: '+err.message;
      })
  }

  function marmaraTransfer() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let wif = document.getElementById("idMarmaraTransferWif").value;
    let receivetxid = document.getElementById("idMarmaraReceiveForTransferTxid").value;
    let receiverpk = document.getElementById("idMarmaraTransferReceiverPubkey").value;

    document.getElementById("idTxhex").value = '';
    document.getElementById("idTxid").innerHTML = '';
    document.getElementById("idMarmaraTransferNotify").innerHTML = "Scroll to 'Transaction' to see the results";

    myLibrary.marmaraTransfer(wif, receivetxid, receiverpk)
      .then((res)=>{ 
        document.getElementById("idTxhex").value = res.txhex;
      }) 
      .catch(err=>{
        document.getElementById("idTxhex").value = 'tx creation error: '+err.message;
      })
  }

  function broadcastTxhex() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let txhex = document.getElementById("idTxhex").value;
    document.getElementById("idTxid").innerHTML = '';

    myLibrary.broadcastTxhex(txhex)
      .then((res)=>{ 
        if (res.retcode >= 0)
          document.getElementById("idTxid").innerHTML = res.txid;
        else
          document.getElementById("idTxid").innerHTML = "error: " + res.retcode;
      }) 
      .catch(err=>{
        document.getElementById("idTxid").innerHTML = 'broadcast tx error: '+err.message;
      })
  }

  function marmaraInfo() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let pk = document.getElementById("idMarmaraInfoPubkey").value;
    document.getElementById("idMarmaraInfo").value = '';


    myLibrary.marmaraInfoWrapper(pk)
      .then((res)=>{ 
        document.getElementById("idMarmaraInfo").value = JSON.stringify(res, null, '\t');
        console.log('res=', JSON.stringify(res, null, '\t'));
      }) 
      .catch(err=>{
        console.log('error=', err)
        document.getElementById("idMarmaraInfo").value = 'error: '+err.message;
      })
  }

  function marmaraReceiveList() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    document.getElementById("idMarmaraReceiveListResults").value = '';
    let pk = document.getElementById("idMarmaraReceiveListPubkey").value;

    myLibrary.marmaraReceiveListWrapper(pk)
      .then((res)=>{ 
        document.getElementById("idMarmaraReceiveListResults").value = JSON.stringify(res, null, '\t');
        console.log('res=', JSON.stringify(res, null, '\t'));
      }) 
      .catch(err=>{
        console.log('error=', err)
        document.getElementById("idMarmaraReceiveListResults").value = 'error: '+err.message;
      })
  }

  function marmaraGetCreditLoop() {
    if (!connected) {
      window.alert("not connected");    
      return;
    }

    let mypk = document.getElementById("idMarmaraGetCreditLoopPubkey").value;
    let batontxid = document.getElementById("idMarmaraGetCreditLoopBatonTxid").value;

    myLibrary.marmaraGetCreditLoopWrapper(mypk, batontxid)
      .then((res)=>{ 
        document.getElementById("idMarmaraGetCreditLoopResults").value = JSON.stringify(res, null, '\t');
        console.log('res=', JSON.stringify(res, null, '\t'));
      }) 
      .catch(err=>{
        console.log('error=', err)
        document.getElementById("idMarmaraGetCreditLoopResults").value = 'error: '+err.message;
      })
  }

</script>
</body>
</html>